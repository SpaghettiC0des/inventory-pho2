<?php defined('SYSPATH') or die('No direct script access.');
 
class Item_Model extends ORM {
 	
	protected $belongs_to = ['category','supplier']; 

	public function insert($data){
		$id = $this->db->insert('items', $data)->insert_id();
		return $this->getOne( $id );
	}

	public function getOne($id){
		return $this->db->getwhere('items',['id' => $id]);
	}
 	
 	public function getAll(){
 		return $this->db->get('items');
 	}

    public function getAllOnStock(){
        return $this->db->getwhere('item_stocks',['quantity > ' => 0, 'expiration >'=> \Carbon\Carbon::now()]);
    }

    public function getAllOutOfStock(){
        return $this->db->getwhere('item_stocks', ['quantity =' => 0]);
    }

    public function getAllExpired(){
        return $this->db->getwhere('item_stocks', ['expiration <' => \Carbon\Carbon::now()]);
    }
}